---
title: "Machine Learning Lab"
author: "Graeme Keleher"
date: "July 16, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
```



```{r}
orders <- read_csv("data/Orders.csv", col_types = cols(Order.Date = col_date(format = "%m/%d/%y"), 
    Ship.Date = col_date(format = "%m/%d/%y")))
returns <- read_csv("data/Returns.csv")
```

Check **"Profit"** and **"Sales"** in the dataset, convert these two columns to numeric type. 
```{r}
orders$Profit <- as.numeric(gsub('[$,]', '', orders$Profit))
orders$Sales <- as.numeric(gsub('[$,]', '', orders$Sales))
```

### Problem 2: Inventory Management
- Retailers that depend on seasonal shoppers have a particularly challenging job when it comes to inventory management. Your manager is making plans for next year's inventory.
- He wants you to answer the following questions:
    1. Is there any seasonal trend of inventory in the company?
    2. Is the seasonal trend the same for different categories?

```{r}

orders %>%
  group_by(Order.Date)%>%
  summarise(inventory = sum(Quantity))%>%
  ggplot(aes(Order.Date,inventory))+
  geom_line()+
  geom_smooth()+
  labs(title = "Total Orders", x = "Date","Total Items Ordered")

orders %>%
  group_by(Order.Date, Category)%>%
  summarise(inventory = sum(Quantity))%>%
  ggplot(aes(Order.Date,inventory))+
  geom_line()+
  geom_smooth()+
  facet_grid(Category~.)+
  labs(title = "Total Orders", x = "Date","Total Items Ordered")

```

- Your manager required you to give a brief report (**Plots + Interpretations**) on returned orders.

	1. How much profit did we lose due to returns each year?
	2. How many customer returned more than once? more than 5 times?
	3. Which regions are more likely to return orders?
	4. Which categories 
```{r}
#1
combine <- inner_join(returns,orders, by = c("Order ID" = "Order.ID"))

profit_loss <- sum(combine$Profit)

print(paste("Total lost profit on returned orders in dollars:", profit_loss))

#2
combine %>%
  select('Order ID','Customer.Name')%>%
  distinct()%>%
  group_by(Customer.Name)%>%
  summarise(total_returns = n())%>%
  group_by(total_returns) %>%
  summarise(number_customers = n())%>%
  ggplot(aes(total_returns,number_customers))+
    geom_bar(stat = 'identity')+
  geom_text(aes(label=number_customers),  size=3.5, nudge_y = 10)+
  labs(title = "Number of Customers by Number of Returns",
       x = "Total orders returned",
       y = "Number of Customers")

#3


  
```

